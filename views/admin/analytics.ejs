<%- include('../components/template') %>
<main id="content" class="min-h-screen bg-gradient-to-tr from-gray-900 via-gray-800 to-gray-900 p-8">
  <div class="max-w-7xl mx-auto">
    <div class="sm:flex sm:items-center sm:justify-between mb-8">
      <div>
        <h1 class="text-3xl font-extrabold text-white tracking-tight">
          <%= req.translations.analytics || 'Analytics' %>
        </h1>
        <p class="mt-2 text-gray-400 max-w-xl">
          <%= req.translations.analyticsText || 'View detailed analytics of your Skyport Panel' %>
        </p>
      </div>
    </div>

    <dl class="grid grid-cols-1 gap-6 sm:grid-cols-4">
      <% const cards = [
        { id: 'totalRequests', label: req.translations.totalRequests || 'Total Requests' },
        { id: 'uniqueVisitors', label: req.translations.uniqueVisitors || 'Unique Visitors' },
        { id: 'avgRequestsPerHour', label: req.translations.avgRequestsPerHour || 'Avg Requests/Hour' },
        { id: 'topPage', label: req.translations.topPage || 'Top Page' }
      ]; %>

      <% cards.forEach(card => { %>
      <div class="group overflow-hidden rounded-2xl bg-gradient-to-br from-indigo-700/30 to-indigo-900/60 px-6 py-6 shadow-lg transition-transform transform hover:scale-[1.03] hover:shadow-indigo-500/40">
        <dt class="truncate text-sm font-semibold text-indigo-300">
          <%= card.label %>
        </dt>
        <dd class="mt-2 text-4xl font-extrabold tracking-tight text-white" id="<%= card.id %>">
          <!-- JS data here -->
        </dd>
      </div>
      <% }) %>
    </dl>

    <div class="mt-10 grid grid-cols-1 gap-8 sm:grid-cols-2">
      <section class="rounded-2xl bg-gradient-to-br from-gray-800/70 to-gray-900/80 p-6 shadow-lg">
        <h3 class="mb-5 text-xl font-semibold text-indigo-400 border-b border-indigo-700 pb-2">
          <%= req.translations.trafficOverTime || 'Traffic Over Time' %>
        </h3>
        <canvas id="trafficChart" class="w-full h-64"></canvas>
      </section>

      <section class="rounded-2xl bg-gradient-to-br from-gray-800/70 to-gray-900/80 p-6 shadow-lg">
        <h3 class="mb-5 text-xl font-semibold text-indigo-400 border-b border-indigo-700 pb-2">
          <%= req.translations.topPages || 'Top Pages' %>
        </h3>
        <canvas id="topPagesChart" class="w-full h-64"></canvas>
      </section>
    </div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Fetch analytics data
fetch('/api/analytics')
  .then(response => response.json())
  .then(data => {
    document.getElementById('totalRequests').textContent = data.totalRequests;
    document.getElementById('uniqueVisitors').textContent = data.uniqueVisitors;
    document.getElementById('avgRequestsPerHour').textContent = data.avgRequestsPerHour.toFixed(2);
    document.getElementById('topPage').textContent = data.topPage;

    // Traffic over time chart
    new Chart(document.getElementById('trafficChart'), {
      type: 'line',
      data: {
        labels: data.trafficOverTime.labels,
        datasets: [{
          label: '<%= req.translations.requests || "Requests" %>',
          data: data.trafficOverTime.data,
          borderColor: 'rgb(99, 102, 241)', // Indigo-500
          backgroundColor: 'rgba(99, 102, 241, 0.3)',
          tension: 0.3,
          fill: true,
          pointRadius: 3,
          pointHoverRadius: 6,
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { color: '#A5B4FC' }, // Indigo-300
            grid: { color: 'rgba(165,180,252,0.2)' }
          },
          x: {
            ticks: { color: '#A5B4FC' },
            grid: { color: 'rgba(165,180,252,0.1)' }
          }
        },
        plugins: {
          legend: {
            labels: { color: '#C7D2FE' }
          }
        }
      }
    });

    // Top pages bar chart
    new Chart(document.getElementById('topPagesChart'), {
      type: 'bar',
      data: {
        labels: data.topPages.labels,
        datasets: [{
          label: '<%= req.translations.pageViews || "Page Views" %>',
          data: data.topPages.data,
          backgroundColor: 'rgba(139, 92, 246, 0.7)' // Violet-500 semi-transparent
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { color: '#C4B5FD' }, // Violet-300
            grid: { color: 'rgba(196,181,253,0.15)' }
          },
          x: {
            ticks: { color: '#C4B5FD' },
            grid: { color: 'rgba(196,181,253,0.1)' }
          }
        },
        plugins: {
          legend: {
            labels: { color: '#E0E7FF' }
          }
        }
      }
    });
  })
  .catch(error => {
    console.error('Error fetching analytics data:', error);
  });
</script>

<%- include('../components/footer') %>
